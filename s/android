#!/usr/bin/env bash
# Runs the Flutter app for Android from repo root with prep steps.
set -euo pipefail

ROOT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
APP_DIR="${ROOT_DIR}/app"

log() { printf "[android] %s\n" "$*"; }

command -v flutter >/dev/null 2>&1 || { echo "Flutter not found in PATH"; exit 1; }

cd "${APP_DIR}"

log "flutter pub get"
flutter pub get >/dev/null

log "code generation (build_runner)"
dart run build_runner build --delete-conflicting-outputs >/dev/null

if [[ ! -d android ]]; then
  log "Android folder missing (unexpected for a Flutter project). Creating."
  flutter create . --platforms=android >/dev/null
fi

log "running app (pass -d <deviceId> to select specific device)"
flutter run "$@"
