#!/usr/bin/env bash
set -euo pipefail

compose_file="docker-compose.dev.yml"

if ! command -v docker >/dev/null 2>&1; then
  echo "Docker is required to run this script."
  exit 1
fi

echo "== Starting dependencies (db, redis) =="
docker compose -f "${compose_file}" up -d db redis

echo "== Building app image if needed =="
docker compose -f "${compose_file}" build web

echo "== Preparing and seeding database =="
docker compose -f "${compose_file}" run --rm web bash -lc "bin/rails db:prepare db:seed"
