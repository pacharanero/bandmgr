#!/usr/bin/env bash
# Runs the Flutter app for Linux from repo root with prep steps.
set -euo pipefail

ROOT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
APP_DIR="${ROOT_DIR}/app"

log() { printf "[linux] %s\n" "$*"; }

command -v flutter >/dev/null 2>&1 || { echo "Flutter not found in PATH"; exit 1; }

cd "${APP_DIR}"

log "flutter pub get"
flutter pub get >/dev/null

log "code generation (build_runner)"
dart run build_runner build --delete-conflicting-outputs >/dev/null

log "enable linux desktop (idempotent)"
flutter config --enable-linux-desktop >/dev/null

if [[ ! -d linux ]]; then
  log "creating linux platform folder"
  flutter create . --platforms=linux >/dev/null
fi

log "running app (device: linux)"
flutter run -d linux "$@"
