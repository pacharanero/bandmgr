#!/usr/bin/env bash
set -euo pipefail

compose_file="docker-compose.dev.yml"

if ! command -v docker >/dev/null 2>&1; then
  echo "Docker is required to run this script."
  exit 1
fi

# Run Rails test suite inside the web image (assumes services already up)
exec docker compose -f "${compose_file}" run --rm \
  -e RAILS_ENV=test \
  -e DATABASE_URL=postgres://bandmgr:bandmgr@db:5432/bandmgr_test \
  web bash -lc "bundle exec rails db:test:prepare test test:system"
