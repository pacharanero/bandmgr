<% content_for :title, "Import Songs" %>

<div class="mx-auto max-w-3xl rounded-lg border border-slate-200 bg-white p-6 shadow-sm">
  <h1 class="text-xl font-semibold text-slate-900">Import songs</h1>
  <p class="mt-2 text-sm text-slate-600">Paste a list, a Markdown list, or upload a CSV file.</p>
  <div class="mt-3 rounded-md bg-slate-50 p-3 text-sm text-slate-700">
    <p class="font-semibold text-slate-800">Formatting tips</p>
    <ul class="mt-1 list-disc pl-5">
      <li>Plain text: one per line, <code>Title - Artist</code>. If no artist is given, only the title is stored.</li>
      <li>Markdown lists are OK (bullets or numbers) as long as each line is <code>Title - Artist</code>.</li>
      <li>CSV: <code>title, artist, key, tempo, notes</code> columns in that order.</li>
    </ul>
    <div class="mt-2 grid gap-2 md:grid-cols-2">
      <div class="rounded border border-slate-200 bg-white p-2 text-xs text-slate-700">
        <p class="font-semibold">Plain / Markdown example</p>
<pre class="mt-1 whitespace-pre-wrap text-[11px]">Title1 - Artist1
Title2 - Artist2
- Title3 - Artist3
1. Title4 - Artist4</pre>
      </div>
      <div class="rounded border border-slate-200 bg-white p-2 text-xs text-slate-700">
        <p class="font-semibold">What gets stored</p>
        <p class="mt-1">We split on <code> - </code> into <strong>Title</strong> and optional <strong>Artist</strong>. Blank artist is allowed.</p>
      </div>
    </div>
  </div>

  <%= form_with url: import_songs_path, method: :post, html: { multipart: true }, class: "mt-6 space-y-4" do |form| %>
    <div>
      <%= form.label :band_id, "Band", class: "block text-sm font-medium text-slate-700" %>
      <%= form.collection_select :band_id, @bands, :id, :name, { prompt: "Select a band", selected: params[:band_id] }, class: "mt-1 w-full rounded-md border border-slate-300 px-3 py-2" %>
    </div>

    <div>
      <%= form.label :format_type, "Format", class: "block text-sm font-medium text-slate-700" %>
      <%= form.select :format_type, options_for_select([["Plain text", "plain"], ["Markdown list", "markdown"], ["CSV", "csv"]], @format), {}, class: "mt-1 w-full rounded-md border border-slate-300 px-3 py-2" %>
    </div>

    <div>
      <%= form.label :data, "Paste song list", class: "block text-sm font-medium text-slate-700" %>
      <%= form.text_area :data, rows: 10, class: "mt-1 w-full rounded-md border border-slate-300 px-3 py-2" %>
      <p class="mt-2 text-xs text-slate-500">One song per line, formatted as <code>Song Title - Artist</code>. Bandmgr will split the title and artist automatically at <code> - </code>.</p>
    </div>

    <div>
      <div class="flex flex-wrap items-center justify-between gap-2">
        <%= form.label :file, "Or upload a file", class: "block text-sm font-medium text-slate-700" %>
        <%= link_to "Download CSV template", "/templates/song_import_template.csv", class: "text-xs font-semibold text-slate-700 underline" %>
      </div>
      <%= form.file_field :file, class: "mt-1 w-full text-sm text-slate-600" %>
      <p class="mt-2 text-xs text-slate-500">CSV columns should be: title, artist, key, tempo, notes.</p>
    </div>

    <div class="flex items-center justify-between gap-3">
      <div>
        <% if current_account&.ai_enabled? %>
          <span class="inline-flex items-center rounded-md bg-emerald-50 px-2 py-1 text-xs font-semibold text-emerald-700">AI ready</span>
        <% else %>
          <span class="inline-flex items-center rounded-md bg-slate-100 px-2 py-1 text-xs font-semibold text-slate-500">AI disabled (add key in Account settings)</span>
        <% end %>
      </div>
      <div class="flex items-center gap-3">
        <%= link_to "Cancel", songs_path, class: "text-sm text-slate-600 hover:text-slate-900" %>
        <%= button_tag "AI parse", type: "button", class: "rounded-md border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-400", disabled: !current_account&.ai_enabled?, title: "Configure AI to enable this" %>
        <%= form.submit "Import songs", class: "rounded-md bg-slate-900 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800" %>
      </div>
    </div>
  <% end %>
</div>
